extends ../layouts/main-layout.pug

block styles
    link(rel="stylesheet" href="/css/profile.css")
    link(rel="stylesheet" href="/css/products-table.css")

block megaMenu 
    include ../includes/menu.pug

block content
    .container.emp-profile
        form(method='post')
            .row
                //- .col-md-4
                //-     .profile-img
                //-         img(src='https://via.placeholder.com/140x100' alt='')

                .col-md-10
                    .profile-head
                        h3 
                            b #{user.name} #{user.surname}
                        h6
                            b Garavolli Üyesi
                        p.proile-rating
                            b Derece : 
                            span 8/10
                .col-md-2
                    a.btn.btn-outline-primary(href="#" name='btnAddMore' value='Profili Düzenle').editProfileButton Profili Düzenle
                    a(href="/admin/choose-category" class="btn btn-sm btn-outline-success btn-create").mt-1
                        |Yeni Ürün 
                        i(class="fas fa-plus")

            ul#myTab.nav.nav-tabs(role='tablist').mt-3.mb-3
                            li.nav-item
                                a#home-tab.nav-link.active(data-toggle='tab' href='#home' role='tab' aria-controls='home' aria-selected='true') Hesap Bilgisi
                            li.nav-item
                                a#products-tab.nav-link(data-toggle='tab' href='#products' role='tab' aria-controls='profile' aria-selected='false') Ürünlerim
                            li.nav-item
                                a#orders-tab.nav-link(data-toggle='tab' href='#orders' role='tab' aria-controls='profile' aria-selected='false') Siparişlerim       
            .row
                .col-md-12
                    #myTabContent.tab-content.profile-tab
                        #home.tab-pane.fade.show.active(role='tabpanel' aria-labelledby='home-tab')
                            .row
                                .col-md-6
                                    label İsim
                                .col-md-6
                                    p #{user.name}
                            .row
                                .col-md-6
                                    label Soyisim
                                .col-md-6
                                    p #{user.surname}
                            
                            .row
                                .col-md-6
                                    label Email
                                .col-md-6
                                    p #{user.email}
                            
                            .row
                                .col-md-6
                                    label Satışta olan ürün sayısı
                                .col-md-6
                                    p #{products.length}

                            .row
                                .col-md-6
                                    label Sipariş Sayısı
                                .col-md-6
                                    p #{orders.length}

                        #products.tab-pane.fade(role='tabpanel' aria-labelledby='products-tab')
                            if products.length > 0
                                table.table.table-striped.table-bordered.table-list.bg-light
                                    thead
                                        tr
                                            th(style="width: 80px;") Resmi    
                                            th(style="width: auto;") Ürün adı
                                            th(style="width: auto;") Fiyatı 
                                            th(style="width: auto; text-align:center;")
                                                em(class="fa fa-cog")
                                            
                                    tbody
                                        each product in products
                                            tr
                                                td
                                                    img(src=`/img/${product.imageUrl[0]}` width='80')
                                                
                                                td.hidden-xs.text-uppercase #{product.name}
                                                td #{product.price} TL
                                                td.mr-0.ml-0.pr-0.pl-0
                                                    a(href=`/admin/products/${product._id}` data-toggle="tooltip" data-placement="top" title="Ürünü Düzenle").btn.btn-default
                                                        em(class="fas fa-edit fa-lg")
                                                        

                                                    form(action="/admin/delete-product" method="POST" onSubmit="return confirm('Silmek istediğinden emin misin?') ")
                                                        input(type="hidden" name="_csrf" value=`${csrfToken}`)
                                                        input(type="hidden" name="productid" value=`${product._id}`)
                                                        button(type="submit" data-toggle="tooltip" data-placement="top" title="Ürünü Kaldır").btn.btn-danger
                                                            em(class="fas fa-trash-alt")
                                                            
                            else
                                h1 Henüz satılacak ürününüz yok.

                        #orders.tab-pane.fade(role='tabpanel' aria-labelledby='orders-tab')
                            if orders.length > 0 
                                each order in orders
                                    .card.mb-5
                                        .card-header
                                            h3 Sipariş numarası: ##{order._id}
                                        table.table.table-bordered.table-hover
                                            thead.thead-dark
                                                tr
                                                    th Resim
                                                    th Ürün Adı
                                                    th Fiyatı
                                                    th Miktarı
                                            tbody
                                                each item in order.items
                                                    tr
                                                        td
                                                            img(src=`/img/${item.product.imageUrl[0]}` width="80")
                                                        td #{item.product.name}
                                                        td #{item.product.price}
                                                        td #{item.quantity}
                                            tfoot
                                                tr
                                                    td(colspan="2") #{order.date}
                                                    td
                                                    - var total = 0;
                                                    each item in order.items
                                                        - total += (item.product.price * item.quantity)
                                                    td  #{total} TL

                            else
                                h1 Henüz sipariş vermemişsiniz.
                            



block script
    script(src="/js/profile.js")